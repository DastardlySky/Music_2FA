[phases.setup]
nixPkgs = ["nodejs_20", "python3", "ffmpeg"]

[phases.install]
# Create a local bin directory and symlink python3 to python.
# We set the PATH inline for npm ci so it can find the 'python' command.
cmds = [
  "mkdir -p /app/bin",
  "ln -s $(which python3) /app/bin/python",
  "PATH=/app/bin:$PATH npm ci"
]

[variables]
NODE_ENV = "production"
NIXPACKS_NODE_VERSION = "20"
# We don't set PATH here because Nixpacks doesn't support $PATH interpolation in the variables block,
# which was causing 'command not found' errors in the previous build.
